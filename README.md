# PyNovel-AI

PyNovel-AI 是一个基于 LLM（大语言模型）的自动化长篇小说创作工具。它通过“迭代生成”与“上下文持久化”技术，能够帮助你从一个简单的创意出发，构思数万甚至数十万字的长篇故事。

## 🌟 核心特性

- **分阶段构思**：采用“分阶段生成”模式。先生成全书大纲，再细化为章节小节，最后逐节创作正文，确保长篇逻辑不崩坏。
- **智能断点续传**：
  - **大纲复用**：如果由于网络或其他原因中断，重新运行可直接读取已有大纲。
  - **章节续写**：自动识别已生成的章节并跳过，无缝衔接未完成的任务。
- **上下文持久化（Summary-based Continuity）**：
  - 每创作完一个小节，系统会自动生成并保存该节的**摘要（Summary）**。
  - 续写时，系统会读取前文摘要作为 LLM 的背景参考，保证故事逻辑的连贯性，同时节省 Token。
- **AI 驱动的配置文件生成**：提供 `config_generator.py` 工具，只需提供简单想法，AI 即可为你生成完整的角色、背景及风格设定。
- **针对创作優化的安全设置**：
  - 特别针对 Gemini 驱动进行了优化，默认开启宽松的安全阈值（`BLOCK_NONE`），适合创意文学创作。
  - 内置“去敏感化”提示策略，通过文学化叙术规避 AI 的硬性拦截。
- **灵活的批处理（Batching）**：支持自定义大纲生成步长（默认 10 章），大幅提升构思效率。
- **多模型驱动**：支持 Gemini 及所有与其 API 兼容的模型。

## 📁 目录结构

```text
PyNovel-AI/
├── core/               # 核心逻辑
│   ├── config.py       # 配置加载
│   └── generator.py    # 大纲与正文生成引擎
├── drivers/            # LLM 驱动引擎
│   ├── base.py         # 驱动基类
│   └── gemini.py       # Gemini 驱动实现
├── tools/              # 辅助工具
│   └── config_generator.py # AI 配置文件生成器
├── main.py             # 项目主入口
├── config.example.yaml # 配置文件模板
└── .env                # (可选) 用于存储 API Key 的环境变量文件
```

## 🚀 快速上手

### 1. 环境准备

确保安装了 Python 3.8+，并安装依赖：

```bash
pip install -r requirements.txt
```

或者手动安装主要依赖：

```bash
pip install -U google-generativeai openai pyyaml python-dotenv
```

### 2. 配置 API Key

你可以选择以下任一方式：
- 在项目根目录创建 `.env` 文件：`GEMINI_API_KEY=你的KEY`
- 或者在运行程序时根据提示输入。

### 3. 生成小说配置

运行 AI 配置生成器：
```bash
python tools/config_generator.py
```
根据提示输入你的小说创意（例如：“一个关于星际航行与禁忌之恋的故事”），系统会为你生成一个类似 `config.小说名称.yaml` 的文件。

### 4. 开始创作

运行主程序：
```bash
python main.py
```
选择你刚才生成的配置文件，程序将开始：
1. 生成大纲（保存在 `{标题}_outline.md`）。
2. 让用户确认大纲。
3. 确认后，开始逐章逐节创作正文（保存在以小说命名的文件夹中）。

## ⚙️ 配置说明 (`config.yaml`)

| 字段 | 说明 |
| :--- | :--- |
| `provider` | LLM 提供商，目前主要支持 `gemini`。 |
| `model_name` | 使用的模型名称，建议使用 `gemini-1.5-flash` 或 `gemini-pro`。 |
| `batch_size` | 每次生成大纲的章节数量。设置大可提升速度，设置小可提升精细度。 |
| `words_per_section` | 每一小节计划创作的字数。 |
| `details` | 包含角色设定、背景设定、文风要求等详细信息，对创作质量影响巨大。 |

## 💡 创作技巧

- **避开 AI 拦截**：如果你的内容包含敏感或成人元素，请在 `details` 中明确要求 AI 使用“文学化描写”、“艺术化隐喻”，避开直白的生理性描写。
- **手动微调大纲**：大纲生成后，你可以手动编辑 `{标题}_outline.md` 文件。重新运行程序时选择“使用已有大纲”，程序会根据你修改后的大纲进行创作。
- **清理进度**：如果你想彻底重写某一节，只需删除对应的 `.txt` 文件和 `_summary.txt` 文件，重新运行即可。

## 📄 许可证

MIT License
